<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PhishPhind: AI Email Scanner</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- Top Navigation Menu -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">PhishPhind: AI Email Scanner</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav mr-auto">
        <!-- Other menu items can be added here -->
      </ul>
      <button class="btn btn-outline-secondary my-2 my-sm-0" id="openSettingsBtn">Settings</button>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container" id="mainContent">
    <h1 class="mb-4">PhishPhind: AI Email Scanner</h1>

    <!-- Analysis Input -->
    <div class="card mb-3">
      <div class="card-header">Load Message</div>
      <div class="card-body">
        <div class="form-group">
          <label for="messageFile">Upload Message File (This will load the file content into the text box)</label>
          <input type="file" class="form-control-file" id="messageFile" />
        </div>
        <div class="form-group">
          <label for="messageText">Message Content</label>
          <textarea class="form-control" id="messageText" rows="6"></textarea>
        </div>
        <button class="btn btn-success" id="startAnalysisBtn">Start Analysis</button>
      </div>
    </div>

    <!-- Spinner & Progress -->
    <div id="spinner-container" class="text-center mb-4" style="display: none;">
      <div class="spinner-border text-primary" role="status">
        <span class="sr-only">Loading...</span>
      </div>
      <div id="spinner-message" class="mt-2">Processing...</div>
    </div>
    <div class="progress mb-4">
      <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;">0%</div>
    </div>

    <!-- Alert messages -->
    <div id="error-message" class="alert alert-danger" role="alert" style="display: none;"></div>
    <div id="success-message" class="alert alert-success" role="alert" style="display: none;"></div>

    <!-- Results Tabs -->
    <ul class="nav nav-tabs" id="resultTabs" role="tablist"></ul>
    <div class="tab-content" id="resultTabsContent"></div>

    <!-- Export PDF Button -->
    <div class="mt-3">
      <button class="btn btn-secondary" id="savePdfBtn">Export Analysis as PDF</button>
    </div>

    <!-- Analysis History -->
    <div class="card mt-4">
      <div class="card-header">Analysis History</div>
      <div class="card-body" id="analysisHistory">
        <p>No previous analyses.</p>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal fade" id="settingsModal" tabindex="-1" role="dialog" aria-labelledby="settingsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="settingsModalLabel">Settings</h5>
          <button type="button" class="close closeSettings" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- API Key and Model Selection -->
          <div class="form-group">
            <label for="apiKeyInput">OpenAI API Key</label>
            <input type="text" class="form-control" id="apiKeyInput" placeholder="Enter your API key" />
            <small class="form-text text-muted">
              This key will be stored in your browser (insecure).
            </small>
          </div>
          <div class="form-group">
            <label for="modelSelect">Select Model</label>
            <select class="form-control" id="modelSelect">
              <!-- Options will be populated from models.json -->
            </select>
          </div>
          <!-- Workflow Steps Configuration -->
          <div class="form-group">
            <label>Workflow Steps Configuration</label>
            <div class="d-flex align-items-center">
              <span id="stepsFileName">steps.json</span>
              <button class="btn btn-sm btn-info ml-2" id="editStepsBtn">Edit</button>
              <button class="btn btn-sm btn-secondary ml-2" id="uploadStepsBtn">Select JSON</button>
              <input type="file" id="stepsFileInput" style="display: none;" />
            </div>
          </div>
          <!-- Models Configuration -->
          <div class="form-group">
            <label>Models Configuration</label>
            <div class="d-flex align-items-center">
              <span id="modelsFileName">models.json</span>
              <button class="btn btn-sm btn-info ml-2" id="editModelsBtn">Edit</button>
              <button class="btn btn-sm btn-secondary ml-2" id="uploadModelsBtn">Select JSON</button>
              <input type="file" id="modelsFileInput" style="display: none;" />
            </div>
          </div>
          <!-- Hidden Textareas for editing JSON -->
          <div class="form-group" id="stepsEditorContainer" style="display: none;">
            <label for="stepsEditor">Edit Workflow Steps JSON</label>
            <textarea class="form-control" id="stepsEditor" rows="8"></textarea>
          </div>
          <div class="form-group" id="modelsEditorContainer" style="display: none;">
            <label for="modelsEditor">Edit Models JSON</label>
            <textarea class="form-control" id="modelsEditor" rows="4"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="saveSettingsBtn">Save Settings</button>
          <button type="button" class="btn btn-secondary closeSettings" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-warning" id="resetConfigBtn">Reset to Defaults (Keep API Key)</button>
          <button type="button" class="btn btn-danger" id="fullResetBtn">Full Reset (Clear API Key)</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Dependencies -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@2.3.8/dist/purify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf"></script>
  <script src="js/app.js"></script>
</body>
</html>
