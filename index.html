<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PhishPhind: AI Email Scanner</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- Top Navigation Menu -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">PhishPhind: AI Email Scanner</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav mr-auto">
        <!-- Other menu items can be added here -->
      </ul>
      <button class="btn btn-outline-secondary my-2 my-sm-0" id="openSettingsBtn">Settings</button>
    </div>
  </nav>

  <!-- Notification Container -->
  <div id="notification-container"></div>

  <!-- Main Content -->
  <div class="container" id="mainContent">
    <h1 class="mb-4">PhishPhind: AI Email Scanner</h1>

    <!-- Analysis Input -->
    <div class="card mb-3">
      <div class="card-header">Load Message</div>
      <div class="card-body">
        <div class="form-group">
          <label for="messageFile">Upload Message File (This will load the file content into the text box)</label>
          <input type="file" class="form-control-file" id="messageFile" />
        </div>
        <div class="form-group">
          <label for="messageText">Message Content</label>
          <textarea class="form-control" id="messageText" rows="6"></textarea>
        </div>
        <button class="btn btn-success" id="startAnalysisBtn">Start Analysis</button>
      </div>
    </div>

    <!-- Spinner & Progress -->
    <div id="spinner-container" class="text-center mb-4" style="display: none;">
      <div class="spinner-border text-primary" role="status">
        <span class="sr-only">Loading...</span>
      </div>
      <div id="spinner-message" class="mt-2">Processing...</div>
    </div>
    <div class="progress mb-4">
      <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;">0%</div>
    </div>

    <!-- Results Tabs -->
    <ul class="nav nav-tabs" id="resultTabs" role="tablist"></ul>
    <div class="tab-content" id="resultTabsContent"></div>

    <!-- Export PDF Button -->
    <div class="mt-3">
      <button class="btn btn-secondary" id="savePdfBtn">Export Analysis as PDF</button>
    </div>

    <!-- Analysis History -->
    <div class="card mt-4">
      <div class="card-header">Analysis History</div>
      <div class="card-body" id="analysisHistory">
        <p>No previous analyses.</p>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal fade" id="settingsModal" tabindex="-1" role="dialog" aria-labelledby="settingsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="settingsModalLabel">Settings</h5>
          <button type="button" class="close closeSettings" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- Dependencies Visualization - Now full width at the top -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card">
                <div class="card-header">Dependencies</div>
                <div class="card-body">
                  <div id="dependencyVisualization" class="border p-2">
                    <p class="text-muted">Select a step to see dependencies</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        
          <!-- Tab Navigation -->
          <ul class="nav nav-tabs" id="settingsTabs">
            <li class="nav-item">
              <a class="nav-link active" data-toggle="tab" href="#apiSettings">API Settings</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#stepManager">Step Manager</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#advancedSettings">Advanced</a>
            </li>
          </ul>
          
          <!-- Tab Content -->
          <div class="tab-content mt-3">
            <!-- API Settings Tab -->
            <div class="tab-pane fade show active" id="apiSettings">
              <div class="form-group">
                <label for="apiKeyInput">OpenAI API Key</label>
                <input type="text" class="form-control" id="apiKeyInput" placeholder="Enter your API key" />
                <small class="form-text text-muted">
                  This key will be stored in your browser (insecure).
                </small>
              </div>
              <div class="form-group">
                <label for="modelSelect">Select Model</label>
                <select class="form-control" id="modelSelect">
                  <!-- Options will be populated from models.json -->
                </select>
              </div>
            </div>
            
            <!-- Step Manager Tab -->
            <div class="tab-pane fade" id="stepManager">
              <div class="row">
                <!-- Step List Panel (Left) -->
                <div class="col-md-4">
                  <h5>Steps</h5>
                  <div class="mb-2">
                    <button class="btn btn-sm btn-success" id="addStepBtn">Add Step</button>
                    <button class="btn btn-sm btn-info" id="importStepsBtn">Import</button>
                    <button class="btn btn-sm btn-secondary" id="exportStepsBtn">Export</button>
                    <button class="btn btn-sm btn-warning" id="restoreDefaultStepsBtn">Restore Defaults</button>
                  </div>
                  <ul id="stepList" class="list-group step-sortable">
                    <!-- Steps will be populated here -->
                  </ul>
                </div>
                
                <!-- Step Editor Panel (Right) -->
                <div class="col-md-8">
                  <div id="stepEditorPanel">
                    <h5>Step Editor</h5>
                    <div class="form-group">
                      <label for="stepId">Step ID</label>
                      <input type="text" class="form-control" id="stepId">
                      <small class="form-text text-muted">Unique identifier (no spaces, lowercase, underscores)</small>
                    </div>
                    <div class="form-group">
                      <label for="stepMenuName">Menu Name</label>
                      <input type="text" class="form-control" id="stepMenuName">
                    </div>
                    <div class="form-group">
                      <label for="stepPrompt">Step Prompt</label>
                      <div class="mb-2">
                        <div class="dropdown d-inline-block">
                          <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="variablePickerBtn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Insert Variable
                          </button>
                          <div class="dropdown-menu" id="variablePickerMenu" aria-labelledby="variablePickerBtn">
                            <!-- Will be populated dynamically -->
                          </div>
                        </div>
                      </div>
                      <textarea class="form-control" id="stepPrompt" rows="6"></textarea>
                    </div>
                    <div class="form-group">
                      <label for="stepInstructions">LLM Instructions</label>
                      <textarea class="form-control" id="stepInstructions" rows="6"></textarea>
                    </div>
                    <button class="btn btn-primary" id="saveStepBtn">Save Step</button>
                    <button class="btn btn-secondary" id="cancelStepEditBtn">Cancel</button>
                    <button class="btn btn-warning" id="resetStepBtn">Reset to Original</button>
                    <button class="btn btn-info" id="exportStepBtn">Export as Text</button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Advanced Settings Tab -->
            <div class="tab-pane fade" id="advancedSettings">
              <div class="form-group">
                <label for="stepsEditor">Workflow Steps JSON</label>
                <textarea class="form-control" id="stepsEditor" rows="8"></textarea>
              </div>
              <div class="form-group">
                <label for="modelsEditor">Models JSON</label>
                <textarea class="form-control" id="modelsEditor" rows="4"></textarea>
              </div>
              <button class="btn btn-primary" id="saveAdvancedBtn">Save Changes</button>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="saveSettingsBtn">Save Settings</button>
          <button type="button" class="btn btn-secondary closeSettings" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-warning" id="resetConfigBtn">Reset to Defaults (Keep API Key)</button>
          <button type="button" class="btn btn-danger" id="fullResetBtn">Full Reset (Clear API Key)</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Unsaved Changes Modal -->
  <div class="modal fade" id="unsavedChangesModal" tabindex="-1" role="dialog" aria-labelledby="unsavedChangesModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="unsavedChangesModalLabel">Unsaved Changes</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          You have unsaved changes in the current step. Would you like to save them before proceeding?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" id="discardChangesBtn">Discard Changes</button>
          <button type="button" class="btn btn-primary" id="saveChangesBtn">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Dependencies -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@2.3.8/dist/purify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
  
  <!-- Application Scripts -->
  <script src="js/config.js"></script>
  <script src="js/notifications.js"></script>
  <script src="js/api.js"></script>
  <script src="js/steps.js"></script>
  <script src="js/history.js"></script>
  <script src="js/pdf.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
